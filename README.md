# MoviePilot 多版本下载插件

> **功能：** 突破洗版限制，自动下载多个规则组匹配的版本
>
> **版本：** V2 (适用于 MoviePilot V2)
>
> **作者：** MoviePilot Community

---

## 📖 插件说明

### 核心功能
- 监听订阅下载完成事件
- 根据用户选择的规则组，自动下载其他版本
- 完全复用MP的搜索和下载API，安全可靠
- 通过检查下载历史避免重复下载
- 直接调用 DownloadChain 绕过订阅的洗版检查

### 使用场景
- **多设备需求**：同时下载 4K（家庭影院）和 1080P（移动设备）
- **版本收藏**：收藏不同字幕组、不同压制组的版本
- **画质对比**：保留多个版本方便对比选择

---

## 🚀 安装方法

### 1. 在MP中添加插件源

进入 **设置** → **插件**，找到 **第三方插件仓库**，添加：

```
https://github.com/你的用户名/MoviePilot-Plugins-MultiVersion
```

### 2. 安装插件

进入 **插件** 页面，切换到你的插件源，找到 **多版本下载**，点击安装。

### 3. 配置插件

- ✅ 启用插件
- ⏱️ 设置延迟时间（推荐 15-30秒）
- 📋 勾选需要下载的规则组

---

## ⚙️ 前置条件

### 1. 重命名格式包含 videoFormat

**位置：** 设置 → 整理 → 重命名格式

**检查：** 确保包含 `{% if videoFormat %} - {{videoFormat}}{% endif %}`

**默认格式已包含**，如果是自定义格式需要确认。

### 2. 覆盖模式

**位置：** 设置 → 目录 → 覆盖模式

**推荐：** 从不覆盖 或 大覆盖小

### 3. 规则组配置

**位置：** 设置 → 过滤规则

**要求：** 至少创建 2 个规则组

**示例：**
- 4K规则: `4K & CNSUB`
- 1080P规则: `1080P & CNSUB`

---

## 🎯 工作原理

```
用户添加订阅
  ↓
MP订阅处理
  ├─ 搜索资源
  ├─ 应用规则（下载4K）
  ├─ 洗版检查
  └─ 触发 DownloadAdded 事件
  
插件自动介入
  ├─ 等待设定时间
  ├─ 处理4K规则 → 已存在 → 跳过
  └─ 处理1080P规则 → 不存在 → 下载
  
MP自动整理
  ├─ 电影名 (年份) - 2160p.mkv
  └─ 电影名 (年份) - 1080p.mkv

✅ 多版本共存！
```

---

## ❓ 常见问题

### Q: 会重复下载吗？
**A:** 不会。插件通过种子hash检查下载历史，相同hash会自动跳过。

### Q: 支持洗版吗？
**A:** 完全支持。插件直接调用 DownloadChain，自动绕过订阅的洗版限制。

### Q: 为什么版本能共存？
**A:** MP的重命名格式包含 videoFormat，不同分辨率会有不同文件名。

### Q: 需要配置下载路径吗？
**A:** 不需要。使用MP的默认逻辑，自动匹配目录。

---

## 📝 更新日志

### v1.0.0 (2025-11-03)
- 首次发布
- 支持自动下载多个规则组匹配的版本
- 完全复用MP官方API
- 基于hash精确去重
- 用户可配置延迟时间

---

## 🔧 技术特点

- ✅ 完全复用MP官方API（SearchChain、DownloadChain）
- ✅ 基于种子hash精确去重
- ✅ MP自动重命名区分不同分辨率
- ✅ 支持用户自定义延迟时间
- ✅ 详细的日志输出和统计

---

## 📄 许可证

本插件遵循 MIT 许可证。

---

## 💬 反馈与支持

如有问题或建议，请在 Issues 中提交。

---

**享受多版本收藏的乐趣吧！** 🎉

